module.exports = function(schema, options) {
	options = options || {};

	var createdAt = options.createdAt || 'createdAt';
	var updatedAt = options.updatedAt || 'updatedAt';

	var update = function() {
		var now = new Date();
		var update = { $set: {}, $setOnInsert: {} };

		update.$set[updatedAt] = now;
		update.$setOnInsert[createdAt] = now;

		return update;
	};

	var properties = {};
	properties[createdAt] = Date;
	properties[updatedAt] = Date;

	schema.add(properties);

	schema.pre('save', function(next) {
		var now = new Date();

		this[createdAt] = this[createdAt] || now;
		this[updatedAt] = now;
		next();
	});

	schema.pre('findOneAndUpdate', function(next) {
		this.findOneAndUpdate({}, update());
		next();
	});

	schema.pre('update', function(next) {
		this.update({}, update());
		next();
	});
};
